<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Integrated Transport and Health Impact Model • ithimr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Integrated Transport and Health Impact Model">
<meta property="og:description" content="Modelling the impact of transport choices on population health.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ithimr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<hr>
<p>output: html_document: default pdf_document: default —</p>
<div id="ithim-r" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#ithim-r" class="anchor"></a>ITHIM-R</h1></div>
<p>Development of the ITHIM-R, also known as ITHIM version 3.0. Started in January 2018.</p>
<p>This document aims to be a comprehensive record of the calculations in the ITHIM pipeline, specifically the ITHIM- R package. Some details here (and the default inputs to the functions) are specific to the Accra version of that model, as Accra has been the setting for construction of the prototype.</p>
<div id="citation" class="section level3">
<h3 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h3>
<p>To cite package ‘ithimr’ in publications use:</p>
<blockquote>
<p>Rob Johnson and Ali Abbas (2021). ithimr: Integrated Transport and Health Impact Model. R package version 0.1.1.</p>
</blockquote>
<p>A BibTeX entry for LaTeX users is</p>
<blockquote>
<p>@Manual{, title = {ithimr: Integrated Transport and Health Impact Model}, author = {Rob Johnson and Ali Abbas}, year = {2021}, note = {R package version 0.1.1}, }</p>
</blockquote>
</div>
<div id="outline" class="section level3">
<h3 class="hasAnchor">
<a href="#outline" class="anchor"></a>Outline</h3>
<p>In this document, in general, lower-case letters correspond to indices, or dimensions, of objects, and take one of a set of possible values, detailed in Table 1 (Convert from LATEX).</p>
<p>The set of fixed input data items are denoted by capital letters, and variable parameters are denoted by greek letters. These are tabulated in Table 2 (Convert from LATEX).</p>
</div>
<div id="data-inputs" class="section level3">
<h3 class="hasAnchor">
<a href="#data-inputs" class="anchor"></a>Data inputs</h3>
<p>ITHIM-R requires 5 user defined input files in csv format, saved in a directory of the city’s name. See inst/ext/local/accra for example files. There are also numerous assumptions that you can parameterize in the model.</p>
<div id="file-inputs" class="section level4">
<h4 class="hasAnchor">
<a href="#file-inputs" class="anchor"></a>File inputs</h4>
<ul>
<li>
<p>Travel survey (trips_CITY.csv) - a table of all trips taken by a group of people on a given day. Includes people who take no trips.</p>
<ul>
<li>One row per trip (or stage of trip)</li>
<li>Minimal columns: participant_id, age, sex, trip_mode, trip_duration (or trip_distance)</li>
<li>Other columns: stage_mode, stage_duration (or stage_distance)</li>
</ul>
</li>
<li>
<p>Recorded injury events (injuries_CITY.csv) - a table of recorded road-traffic injury (fatality) events in a city in one or more years.</p>
<ul>
<li>One row per event</li>
<li>Minimal columns: cas_mode and strike_mode</li>
<li>Other columns: year, cas_age, cas_gender, weight (e.g. multiple years combined)</li>
</ul>
</li>
<li>
<p>Disease burden data (gbd_CITY.csv)</p>
<ul>
<li>One row per disease/metric/age/gender combination</li>
<li>Minimal rows: Measure (death/YLL); sex_name (Male/Female); age_name (‘x to y’); Cause_name (disease names); Val (value of burden); population (number of people Val corresponds to, e.g. population of country)</li>
</ul>
</li>
<li>
<p>Population of city (population_CITY.csv) - in order to scale the burden in Disease burden data to the city under study</p>
<ul>
<li>One row per demographic group</li>
<li>Columns: sex, age, population</li>
<li>age column should share boundaries with age_name in Disease burden data, but can be more aggregated</li>
</ul>
</li>
<li>
<p>Physical activity survey (pa_CITY.csv)</p>
<ul>
<li>One row per person</li>
<li>Columns: sex, age, work_ltpa_marg_met = total leisure and work PA in a week</li>
</ul>
</li>
</ul>
</div>
<div id="function-call-inputs" class="section level4">
<h4 class="hasAnchor">
<a href="#function-call-inputs" class="anchor"></a>Function-call inputs</h4>
<p>The following values are set in the call to the set-up function (run_ithim_setup).</p>
<ul>
<li>
<p>Values for navigation:</p>
<ul>
<li>CITY - the name of the city, which is also the name of the directory contain the 5 files</li>
<li>setup_call_summary_filename</li>
<li>PATH_TO_LOCAL_DATA</li>
</ul>
</li>
<li>
<p>City-specific values</p>
<ul>
<li>speeds</li>
<li>emission_inventory</li>
</ul>
</li>
<li>
<p>Model parameters</p>
<ul>
<li>DIST_CAT</li>
<li>AGE_RANGE</li>
<li>ADD_WALK_TO_BUS_TRIPS</li>
<li>ADD_BUS_DRIVERS</li>
<li>ADD_TRUCK_DRIVERS</li>
<li>TEST_WALK_SCENARIO</li>
<li>TEST_CYCLE_SCENARIO</li>
<li>MAX_MODE_SHARE_SCENARIO</li>
<li>REFERENCE_SCENARIO</li>
<li>NSAMPLES</li>
</ul>
</li>
</ul>
<p>The following values can be uncertain - i.e. they can be sampled from pre-specificied distributions, and the model run multiple (NSAMPLES) times, in order to evaluate the output with varying inputs.</p>
<p>For distributions (lognormal and beta), a single numeric input becomes the set value for that parameter. A vector of length 2 becomes the parameters for the distribution from which samples are taken.</p>
<p>Confidence values between 0 and 1 are used to parametrise a beta distribution or a Dirichlet distribution. A confidence value of 1 corresponds to a Delta function, i.e. there is no uncertainty.</p>
<p>Logic values determine how the dose–response relationships are used: if F, the mean DR relationship is used. If T, DR curves are sampled.</p>
<ul>
<li>
<p>Pollution values:</p>
<ul>
<li>PM_CONC_BASE - lognormal - background PM2.5 concentration</li>
<li>PM_TRANS_SHARE - beta - proportion of background PM2.5 attributable to transport</li>
<li>EMISSION_INVENTORY_CONFIDENCE - value between 0 and 1 - how confident we are about the emission inventory</li>
</ul>
</li>
<li>
<p>PA values:</p>
<ul>
<li>BACKGROUND_PA_SCALAR - lognormal - scalar for physical activity</li>
<li>BACKGROUND_PA_CONFIDENCE - value between 0 and 1 - how confident we are about the PA survey (in terms of the number of people who report 0 PA)</li>
<li>MMET_CYCLING - lognormal - mMET value associated with cycling</li>
<li>MMET_WALKING - lognormal - mMET value associated with walking</li>
</ul>
</li>
<li>
<p>Travel values:</p>
<ul>
<li>BUS_WALK_TIME - lognormal - time taken to walk to PT</li>
<li>DAY_TO_WEEK_TRAVEL_SCALAR - beta - how daily travel scales to a week</li>
<li>BUS_TO_PASSENGER_RATIO - beta - number of buses per passenger</li>
<li>TRUCK_TO_CAR_RATIO - beta - number of trucks per car</li>
<li>DISTANCE_SCALAR_CAR_TAXI - lognormal - scalar for car/taxi distance</li>
<li>DISTANCE_SCALAR_WALKING - lognormal - scalar for walking distance</li>
<li>DISTANCE_SCALAR_PT - lognormal - scalar for PT distance</li>
<li>DISTANCE_SCALAR_CYCLING - lognormal - scalar for cycling distance</li>
<li>DISTANCE_SCALAR_MOTORCYCLE - lognormal - scalar for motorcycle distance</li>
</ul>
</li>
<li>
<p>Health values:</p>
<ul>
<li>PA_DOSE_RESPONSE_QUANTILE - logic - whether or not to sample from DR curves</li>
<li>AP_DOSE_RESPONSE_QUANTILE - logic - whether or not to sample from DR curves</li>
<li>CHRONIC_DISEASE_SCALAR - lognormal - scalar for GBD data</li>
</ul>
</li>
<li>
<p>Injury values:</p>
<ul>
<li>INJURY_REPORTING_RATE - lognormal - the rate at which injuries are reported</li>
<li>SIN_EXPONENT_SUM lognormal parameter: linearity of injuries with respect to two modes. SIN_EXPONENT_SUM=2 means no safety in numbers.</li>
<li>CASUALTY_EXPONENT_FRACTION - beta - fraction of SIN_EXPONENT_SUM attributed to casualty mode</li>
</ul>
</li>
</ul>
</div>
<div id="synthetic-population" class="section level4">
<h4 class="hasAnchor">
<a href="#synthetic-population" class="anchor"></a>Synthetic Population</h4>
<p><strong>Description</strong> The first input you will need to provide is the synthetic population data. This data typically comes from a household travel survey or travel time use survey, and a self-report leisure time physical activity survey. These data will be uses throughout the process.</p>
<p><strong>Synthetic Population Dataset Format</strong> You should have a table with the following variables</p>
<ul>
<li>trip_id</li>
<li>trip_mode</li>
<li>trip_duration</li>
<li>participant_id</li>
<li>age</li>
<li>sex</li>
<li>age_cat</li>
<li>ltpa_marg_met</li>
<li>work_marg_met</li>
</ul>
</div>
<div id="who-hit-who-matrix" class="section level4">
<h4 class="hasAnchor">
<a href="#who-hit-who-matrix" class="anchor"></a>Who Hit Who Matrix</h4>
<p><strong>Description</strong> TEXT HERE</p>
<p><strong>Who Hit Who Matrix Dataset Format</strong> A matrix</p>
</div>
</div>
<div id="air-pollution" class="section level3">
<h3 class="hasAnchor">
<a href="#air-pollution" class="anchor"></a>Air Pollution</h3>
<p><strong>Description</strong> TEXT HERE</p>
<p><strong>Air Pollution Dataset Format</strong> A matrix</p>
<p><strong>We are currently working on developing a separate package to create a synthetic population</strong></p>
<p>For further documentation consult the wiki. For ongoing discussions, see issues. In addition, relevant documents are stored in shared GDrive folder, and a Slack channel is available for communications among contributors.</p>
<p>See <a href="https://github.com/ITHIM/ITHIM-R/wiki/Communication-channels">communication channels on Wiki</a></p>
</div>
<div id="related-repositories" class="section level2">
<h2 class="hasAnchor">
<a href="#related-repositories" class="anchor"></a>Related Repositories</h2>
<ul>
<li><a href="https://github.com/ITHIM/ITHIM">ITHIM (R, Physical Activity)</a></li>
<li><a href="https://github.com/ITHIM/ithim-r-interface">ITHIM Interface (R, Shiny)</a></li>
</ul>
</div>
<div id="how-the-code-works" class="section level2">
<h2 class="hasAnchor">
<a href="#how-the-code-works" class="anchor"></a>How The Code Works</h2>
<p>There are three main blocks to the code: setting up, running the model, and assessing uncertainty. The first block, <code>run_ithim_setup</code>, sets the variables for computing the ITHIM. This is done in the second block, <code>run_ithim</code>. The separation of these blocks aims to isolate computations that are processing steps from those that contribute to the ITHIM calculation. (This distinction should mean that Section <code>run_ithim_setup</code> is a data harmonisation step and deals with all location-specific issues, whereas <code>run_ithim</code> should be able to be exactly the same for all settings. Another view of grouping the steps is those that, when sampling, we do only once, and those we do in a loop. This breaks down when distance-related parameters become uncertain.) Finally, <code>ithim_uncertainty</code> is a wrapper for sampling from the ITHIM output in a loop. <code>ithim_uncertainty</code> is used for the ‘’sample’’ use case. We refer to using <code>run_ithim</code> alone as the ‘’constant’’ use case, as all parameters are set to constant values.</p>
<div id="setting-up" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up" class="anchor"></a>Setting up</h3>
<p><code>run_ithim_setup</code> sets the variables for computing the ITHIM. There are functional settings, such as:</p>
<ul>
<li>the number of samples for the ‘’sample’’ use case;</li>
<li>the city;</li>
<li>the travel modes’ speeds, distance relative to car (where relevant), and emission inventory;</li>
<li>the distance categories (for mode-shift scenarios): for Accra these are short (&lt;7km), medium (7–9km), and long (&gt;9km);</li>
<li>a number of constant parameters are set, e.g. the C_i parameters for the pollution calculation which are fixed (<a href="https://www.overleaf.com/read/mrjtkhffzfzr" class="uri">https://www.overleaf.com/read/mrjtkhffzfzr</a>);</li>
<li>the name of a file to which an input summary is written;</li>
<li>whether or not to add bus drivers;</li>
<li>whether or not to add truck drivers;</li>
<li>which scenario acts as the ‘’reference’’;</li>
<li>whether or not to add walk trips to bus trips;</li>
<li>the path to local data files (if not using an ITHIM-R example case).</li>
</ul>
<p>Raw data are loaded in <code>ithim_load_data</code>; the parameters are set or sampled in <code>ithim_setup_parameters</code>; then some distance calculations are made. At present, we compute <code>set_vehicle_inventory</code>, <code>get_synthetic_from_trips</code>, and <code>get_all_distances</code> if (a) ITHIM is running in ‘’constant’’ mode, or (b) ITHIM is running in ‘’sample’’ mode and the variable parameters do not impact the distances or synthetic populations. This separation is to increase efficiency. It might not be necessary if we are unlikely to have sampling use cases that do not impact on distances.</p>
<div id="data" class="section level4">
<h4 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h4>
<p>We load two types of data: location-specific data, and global data. These will be structurally separated in code organisation. The global data persist across settings. Location-specific data will be particular to a single case study and will have to be provided in a particular format (TBC).</p>
<p>The global data include the disease inventory, which lists the diseases we model, whether they depend on PA and AP, and their codenames and acronyms for accessing the relevant quantities elsewhere in the model. The AP acronym will match the cause code in the dose–response AP dataset. The PA acronym will match a file name in the PA dataset for that dose–response relationship. %Distance exponents for injuries will also be global datasets, likewise emission factors, though {these will have to have city-specific versions depending on regulatory standards.}</p>
<p>Location-specific data include the emission inventory, population, and GBD data. It makes sense for the age categories to be used in the model to be defined in this dataset. Column labels include age, sex, cause (matching the disease inventory), measure, metric, population and burden. The ages and genders should match in the population dataset to allow burden imputation for the city. The trip set (survey data) which forms the basis of our synthetic trip set, and PA data, which form the basis of our synthetic population, are also case specific.</p>
<p>Injuries will also be case specific. They are presented in long form, i.e. there is one row per event, and the columns list the specifics of the incident. Column headers should include ‘’strike_mode’’ and ‘’cas_mode’‘, potentially also’‘year’‘,’‘cas_gender’’ and ‘’cas_age’’. From this dataset we form the injury contingency table for regression <code>set_injury_contingency</code>.</p>
</div>
<div id="injury-contingency-table" class="section level4">
<h4 class="hasAnchor">
<a href="#injury-contingency-table" class="anchor"></a>Injury contingency table</h4>
<p><code>set_injury_contingency</code> uses injury data alone to create a contingency table of injuries. Distance data are added later. This contingency table is typically sparse. It enumerates all possible combinations of the covariates in the injury dataset and counts the number of injury (fatality) events fitting that row. It requires matching of covariates across the modules.</p>
</div>
<div id="parameters" class="section level4">
<h4 class="hasAnchor">
<a href="#parameters" class="anchor"></a>Parameters</h4>
<p>Parameters are set or sampled according to what the user supplies. For most variables, a single value will set the variable to that value, whereas a vector of two values will prompt sampling from a prespecified distribution with the given parameters. These distributions are all log normal or beta distributions. AP and PA dose–response relationships work differently. They are binary logical variables which, if false, fix the relationships to their medians and if true prompt sampling of dose–response curves.</p>
</div>
<div id="vehicle-inventory" class="section level4">
<h4 class="hasAnchor">
<a href="#vehicle-inventory" class="anchor"></a>Vehicle inventory</h4>
<p>The vehicle inventory should be a comprehensive record of all vehicle attributes, including: name, aliases, speed, and emission inventory.</p>
</div>
<div id="synthetic" class="section level4">
<h4 class="hasAnchor">
<a href="#synthetic" class="anchor"></a>Synthetic</h4>
<p><strong>Synthetic population</strong> The synthetic population is created by isolating the trip-set individuals and matching to them the individuals surveyed for physical activity. They are matched based on age and gender. For Accra, the age groups are different: the PA people are grouped into 15–55 and 56–69 and matched to the trip set ages grouped as 15–49 and 50–69. These random allocations are not captured anywhere in the VOI analysis.</p>
<p><strong>Synthetic trips</strong> <code>get_synthetic_from_trips</code> takes the loaded trip set and forms from it the synthetic trip set. We add truck and bus driver trips (<code>add_ghost_trips</code>), if the input dictates that they should be added. We create two male truck drivers and two male bus drivers who each take one trip. (N.B. the bus drivers’ mode is ‘’bus_driver’’ to distinguish it from the mode ‘’bus’‘, which is assumed to be taken as a passenger.) Again, the ages are uniformly sampled from the lowest and highest ages of our existing population. The total duration is calculated as before, using the’‘TRUCK_TO_CAR_RATIO’’ (0.21) and ‘’BUS_TO_PASSENGER_RATIO’’ (0.022, CIRT (2011), State Transport Undertakings, Profile &amp; Performance 2008-09, Central Institute of Road Transport, Pune, India) respectively, and is split as before evenly between the drivers.</p>
<p>The bus and truck drivers do not get a person ID and so are not counted in the synthetic population. Therefore, they contribute to other people’s exposure to injury risk and pollution, but they do not contribute to the health burden via the pollution or PA pathways. As they have ages and genders, they do contribute to the at-risk-of-injury road-user population.</p>
<p><strong>Scenarios</strong> <code>ithim_setup_baseline_scenario</code> creates the baseline scenario (by adding distances and the column ‘’Scenario’’ with entries ‘’Baseline’’) and a scenario-generation function creates all the pre-set scenarios by changing the modes of randomly sampled trips (e.g. <code>create_max_mode_share_scenarios</code> and <code>create_all_scenarios</code> for Accra and Sao Paulo) or adding trips for everyone (e.g. <code>create_walk_scenario</code> and <code>create_cycle_scenario</code>). This is another unaccounted-for source of randomness.</p>
</div>
<div id="calculating-distances" class="section level4">
<h4 class="hasAnchor">
<a href="#calculating-distances" class="anchor"></a>Calculating distances</h4>
<p>ITHIM-R requires the distance data in various formats. All these are processed from one function, <code>get_all_distances</code>.</p>
<p><strong>Adding walk trips</strong></p>
<p>First, bus journeys are augmented with a walk component (if the user input dictates it) in the function <code>walk_to_bus_and_combine_scen</code>: we take the set of PT trips, which has J entries. We add J journeys with mode ‘’walk_to_pt’’ and duration WALK_TO_BUS_TIME to the set, with trip_id and participant_id to match that of the corresponding trip in the original set.</p>
<p><strong>Travel summaries</strong></p>
<p>The total distance and duration matrices are calculated in <code>dist_dur_tbls</code>. The distance set is the total distance travelled per mode per scenario, and the duration set is constructed analogously. The distance for bus drivers scales linearly with bus passengers, where the distance in the baseline is defined based on the bus driver distance relative to car.</p>
<p><strong>Injuries</strong></p>
<p>Distances are calculated for the injury module in <code>distances_for_injury_function</code>, where we match mode names to those in the injury dataset, e.g. ‘’taxi’‘,’‘shared_auto’‘,’‘shared_taxi’’ and ‘’car’’ combine to form ‘’car’‘, and’‘auto_rickshaw’’ is added to ‘’motorcycle’’ to represent two/three-wheeled striking vehicle. Some work is required to separate drivers from passengers; we currently assume all travellers are drivers, with the exception of ‘’bus’’. (This is a problem for the examples of Delhi and Bangalore, whose trip sets have car travellers under the age at which driving is permitted and who therefore should not contribute to striking distance.)</p>
<p>We model injuries via regression by predicting the number of fatalities of each demographic group on each mode, which we calculate as a sum over all the ways in which they might have been injured (i.e., all the modes with which they might have collided).</p>
<p>The predictive covariates include the distances travelled by the parties and their demographic details. These requirements lead to a natural separation of the (training) dataset into two groups: a set for which we have distance data for the other party, and a set for which we do not have distance data for the other party. The former equates to a ‘’who hit whom’’ (‘’whw’‘) matrix (albeit in a higher dimension), and will account for changes in injuries resulting of a change in strike-mode travel. The latter corresponds to causes of injury that will not change across scenarios, including’‘no other vehicle’’ and modes of transport that we do not consider to change, which might include trucks and buses if they are not somehow explicitly included in the trip set. We label this group ‘’noov’’: no or other vehicle.</p>
<p>We model the number of injuries as a Poisson-distributed variable with an offset depending on the distance(s) and the reporting rate (<a href="https://www.overleaf.com/read/mrjtkhffzfzr" class="uri">https://www.overleaf.com/read/mrjtkhffzfzr</a>). We choose this form of equation to enable (a) linearity in injuries with respect to total travel combined across modes and (b) linearity in injuries as subdivided by travellers of each mode. Note that this methodology is under development. See <a href="https://github.com/robj411/safety_in_numbers_power_law" class="uri">https://github.com/robj411/safety_in_numbers_power_law</a>.</p>
<p>We use, for Accra, the covariates ‘’casualty_mode*strike_mode’‘,’‘casualty_age’‘, and’‘casualty_gender’‘, to form the model matrix X. We fit the coefficients of the model using data for ten years, assuming the same travel each year, which corresponds to the baseline scenario. To incorporate the injury reporting rate, we set it as an offset, whose value is 1 in fitting the model, and as specified in making predictions. For settings where there are no demographic data (e.g. Delhi), we fit the model using’‘casualty_mode’’ and ‘’strike_mode’’ alone. Predictions are made, as before, by demographic group.</p>
</div>
</div>
<div id="the-ithim-programme" class="section level3">
<h3 class="hasAnchor">
<a href="#the-ithim-programme" class="anchor"></a>The ITHIM programme</h3>
<p><code>run_ithim</code> computes the ITHIM output by calling each module in turn and summarising their outputs in terms of the health burden. Other outputs of the model include: MMETs per person, PM2.5 in each scenario, PM2.5 per person, and injuries burden.</p>
<div id="calculating-background-pm25" class="section level4">
<h4 class="hasAnchor">
<a href="#calculating-background-pm25" class="anchor"></a>Calculating background PM2.5</h4>
<p><code>scenario_pm_calculations</code> uses total distance by mode to compute the total PM2.5 in the scenario. First we compute the emission inventory in terms of fractions. If the confidence is 1 then we use the inventory directly. If P&lt;1, we sample the emission inventory fractions as is (<a href="https://www.overleaf.com/read/mrjtkhffzfzr" class="uri">https://www.overleaf.com/read/mrjtkhffzfzr</a>).</p>
<p>Then we multiply vehicle distance by vehicle emission factor (where the emission factor is the emission inventory (fraction) divided by distance at baseline).</p>
<p>This table is augmented with rows corresponding to any vehicle missing from the trip set. For Accra, these modes include ‘’big trucks’’ and ‘’other’’. The baseline row is equal to the emission inventory fraction. For each scenario, it is scaled. We take the sum over modes to get a scalar for emissions in scenarios. The background PM2.5 in each scenario is the sum of the transport component and the non-transport component.</p>
</div>
<div id="calculating-pm25-per-person" class="section level4">
<h4 class="hasAnchor">
<a href="#calculating-pm25-per-person" class="anchor"></a>Calculating PM2.5 per person</h4>
<p>Individual exposures to PM2.5 are calculated using the background PM2.5 and the trip sets. There are three major components to daily exposure: one, a person’s total inhalation off road; two, a person’s inhalation on road in a vehicle, and, three, a person’s inhalation on road while undertaking active transport. Each category has an amount of background PM2.5 and a ventilation rate which together inform overall exposure.</p>
<p>The ratio of exposure off road to that on road is a function of total PM2.5, defined in <a href="https://www.overleaf.com/read/mrjtkhffzfzr" class="uri">https://www.overleaf.com/read/mrjtkhffzfzr</a> (Goel, 2015). This defines the exposure of a person in an open vehicle (i.e. pedestrian, cyclist or motorist), and it is used to calculate in-vehicle exposure, assuming an exposure with the window closed, and the proportion of vehicles having closed windows. The exposure in a subway is constant and not dependent on the road ratio.</p>
<p>Ventilation rates are calculated for each mode, assuming a base-level inhalation rate, and the mMETs for the mode (Ainsworth compendium 2011 sites.google.com/site/ compendiumofphysicalactivities for walking and cycling). Then the air inhaled during travel per person is the sum over their travel, and the rate of PM2.5 inhalation during travel is a function of the exposure when travelling.</p>
<p>The air inhaled when not travelling is the base-level ventilation times the time spent not travelling. Together, the PM2.5 exposure is calculated as the total PM2.5 inhaled per hour (<a href="https://www.overleaf.com/read/mrjtkhffzfzr" class="uri">https://www.overleaf.com/read/mrjtkhffzfzr</a>).</p>
</div>
<div id="apdisease-doseresponse-relative-risk" class="section level4">
<h4 class="hasAnchor">
<a href="#apdisease-doseresponse-relative-risk" class="anchor"></a>AP–disease dose–response relative risk</h4>
<p><code>gen_ap_rr</code> uses each person’s exposure to PM2.5 to compute their relative risk of five diseases (IHD, lung cancer, COPD, stroke, LRI), using curves parametrised by four disease-specific variables (Burnett, 2014). Of the five diseases, two (IHD and stroke) have parameters specific to age groups starting at age 25. (For any person of age lower than 25, we set the relative risk to 1.) The other three (lung cancer, LRI and COPD) have one set of parameters for all ages.</p>
<p>The curves are in the form of samples of the set of four parameters. We model the densities of these samples (using a quantile for parameter 3, kernel density estimation for parameter 2, and GAMs for parameters 1 and 4) in order to draw either the median or random samples via their quantiles. (The four parameters refer, in numerical order, to alpha, beta, gamma and tmrel in Burnett (2014).)</p>
<p>From these parameters, the relative risk of mortality is defined as in Burnett (2014) as RR = 1 + alpha * (1 - exp( - beta * (AP - tmrel) ^ gamma ) ).</p>
</div>
<div id="individual-level-mmets" class="section level4">
<h4 class="hasAnchor">
<a href="#individual-level-mmets" class="anchor"></a>Individual-level MMETs</h4>
<p>Using trip sets and the synthetic population, <code>total_mmet</code> computes total MMETs per person as the sum of walking MMETs per day and cycling MMETs per day, which are scaled up to a week via the PA scalar, and work/leisure MMETs per week.</p>
<p>We calculate the proportion of people who do no work/leisure PA according to the confidence in the PA survey. First, we calculate the raw probability that a person in demographic group completes no non-travel PA. Then, we set the probability to use as the raw value if our confidence is 1. If it’s less than, we map the confidence to parametrise a Beta distribution.</p>
<p>Finally, for each person in the population, we sample non-travel MMETs as zero with the calculated probability and from the raw non-zero density of their demographic group.</p>
</div>
<div id="padisease-doseresponse-relative-risk" class="section level4">
<h4 class="hasAnchor">
<a href="#padisease-doseresponse-relative-risk" class="anchor"></a>PA–disease dose–response relative risk</h4>
<p><code>gen_pa_rr</code> uses each person’s MMETs per week to compute their relative risk of six diseases, using curves found from meta analysis. Each disease (except type 2 diabetes) has a threshold beyond which there is no further change in relative risk. (Total cancer, breast cancer, colon &amp; rectum cancer, endometrial cancer, &amp; coronary heart disease: 35; lung cancer: 10; stroke: 32; all cause: 16.08.) For all other diseases, we use mortality.</p>
<p>The relative risk for each person for each disease is calculated in <code>PA_dose_response</code> using the curve selected, which is an interpolated mean or a sample of functions. See <a href="https://www.overleaf.com/read/mrjtkhffzfzr" class="uri">https://www.overleaf.com/read/mrjtkhffzfzr</a> for an example.</p>
</div>
<div id="combining-pa-and-ap-relative-risks" class="section level4">
<h4 class="hasAnchor">
<a href="#combining-pa-and-ap-relative-risks" class="anchor"></a>Combining PA and AP relative risks</h4>
<p><code>combined_rr_ap_pa</code> combines the relative risks of <code>gen_ap_rr</code> and <code>gen_pa_rr</code> through multiplication. Not all diseases have a dose–response relationship for both AP and PA. Just stroke, lung cancer, and IHD have both. For the other diseases, only one of the RRs is different from one.</p>
</div>
<div id="calculating-injuries" class="section level4">
<h4 class="hasAnchor">
<a href="#calculating-injuries" class="anchor"></a>Calculating injuries</h4>
<p><code>injuries_function</code> predicts the number of injuries in each scenario based on the training model built from the baseline scenario. We predict for the year 2016 (for Accra), using scenario-specific travel data. The number of fatalities is taken as the sum of fatalities over the strike modes. <code>injury_death_to_yll</code> extrapolates injury deaths to injury YLLs via the ratio in the GBD.</p>
</div>
<div id="calculating-the-health-burden" class="section level4">
<h4 class="hasAnchor">
<a href="#calculating-the-health-burden" class="anchor"></a>Calculating the health burden</h4>
<p><code>health_burden</code> calculates the total health burden relative to the reference scenario (which, by default, is the baseline) using the injury and health outputs combined with GBD data, via population attributable fractions (PAF). We then calculate the PAF relative to the reference scenario.</p>
<p>We estimate the background burden of disease using Global Burden of Disease data and scaling based on the ratio of populations between country and city. If we are scaling the background burden of diseases, we do so here.</p>
<p>We combine the burden with the PAF through multiplication and, finally, for the injuries, we sum over modes to compute the burden and subtract from the values for the reference scenario. Then we have change in burden by cause, per demographic group, per scenario.</p>
</div>
</div>
<div id="uncertain-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#uncertain-parameters" class="anchor"></a>Uncertain parameters</h3>
<p><code>ithim_uncertainty</code> is a wrapper for sampling from the ITHIM output in a loop. The number of samples to take is set at the initiation step, along with specifications of parametric distributions, from which the required number of samples are taken. First, it sets the parameters to the environment for the current sample. Then it recalculates any distance-related objects: <code>set_vehicle_inventory</code> and <code>get_synthetic_from_trips</code> if any raw distances change, and <code>get_all_distances</code> if e.g. the walk-to-bus time has changed. Then the basic <code>run_ithim</code> function is called.</p>
<p>Running ITHIM with uncertain parameters allows assessment of their impact on the outcome (AKA sensitivity analysis). We use EVPPI to calculate the expected reduction in uncertainty in the outcome were we to learn a parameter perfectly. This means we can implement models that are basic in their parametrisation, and learn at the end for which parameters it would be worthwhile spending dedicated time learning better.</p>
<div id="parametric-distributions-for-uncertain-variables" class="section level4">
<h4 class="hasAnchor">
<a href="#parametric-distributions-for-uncertain-variables" class="anchor"></a>Parametric distributions for uncertain variables</h4>
<p>Cycling and walking MMETs are the number of MMETs per hour when undertaking cycling and walking, and determine also the ventilation rates. Motorcycle distance is the total distance travelled by motorcycles relative to the total distance travelled by cars in the baseline scenario. Non-travel PA, injury reporting rate and NCD burden all act as scalars for the relevant datasets. Note that the non-travel PA scalar does not affect the ~40% of the population whose non-travel PA is 0.</p>
</div>
<div id="doseresponse-relationships" class="section level4">
<h4 class="hasAnchor">
<a href="#doseresponse-relationships" class="anchor"></a>Dose–response relationships</h4>
<p>For the dose–response relationships between physical activity (PA) and disease and air pollution (AP) and disease, we assume that there is uncertainty, but no variability, in the relationship. This means that we sample a relationship from the distribution of relationships, and apply that relationship to all individuals precisely. This means that, given fixed doses, responses between individuals will be perfectly correlated.</p>
<p>We achieve this by use of the probability integral transform: we sample a random variable uniformly distributed on the space (0,1) and map it, via a cumulative distribution function, to the distribution describing the dose–response relationship.</p>
</div>
<div id="physical-activity" class="section level4">
<h4 class="hasAnchor">
<a href="#physical-activity" class="anchor"></a>Physical activity</h4>
<p>Each disease’s PA dose–response relationship is defined by a truncated normal. For each dose, there is a mean value, an upper bound, and a lower bound. For each person’s dose, we get the response by mapping the uniform random variable onto the truncated normal defined by the mean and bounds for that dosage.</p>
</div>
<div id="air-pollution-1" class="section level4">
<h4 class="hasAnchor">
<a href="#air-pollution-1" class="anchor"></a>Air pollution</h4>
<p>For the AP relationship, there are four parameters per disease. We sample the first from an empirical distribution using the probability integral transform. We sample the second via the same method, conditioned on the value of the first, constructing their joint density with e.g. kde2d. The third parameter is sampled conditioned on the first and second, constructing their joint density using a GAM. The final parameter is sampled conditioned on the first, second, and third, constructing their joint density using a GAM.</p>
<p>As before, there is perfect correlation between individuals, i.e. if person A’s dose is greater than person B’s, then person A’s response is strictly greater than person B’s response.</p>
<p>The empirical distributions come from Burnett (2014). There are four parameters per disease: IHD, lung cancer, COPD, and stroke. In addition, for stroke and IHD, there is a set of four parameters for each age group from 25 to 95 in five-year increments. In addition to our assumption that there is perfect correlation between individuals for diseases, we assume perfect correlation between ages for diseases. I.e., our four quantiles per disease will be applied to all age groups.</p>
</div>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>What license is it under?</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Rob Johnson <br><small class="roles"> Author, maintainer </small>  </li>
<li>Ali Abbas <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Rob Johnson, Ali Abbas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
