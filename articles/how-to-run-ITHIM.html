<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ithimr">
<title>How to run ITHIM • ithimr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to run ITHIM">
<meta property="og:description" content="ithimr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ithimr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/how-to-run-ITHIM.html">How to run ITHIM</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ITHIM/ITHIM-R/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>How to run ITHIM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ITHIM/ITHIM-R/blob/HEAD/vignettes/how-to-run-ITHIM.Rmd" class="external-link"><code>vignettes/how-to-run-ITHIM.Rmd</code></a></small>
      <div class="d-none name"><code>how-to-run-ITHIM.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="how-to-run-ithim-global">How to run ITHIM-Global<a class="anchor" aria-label="anchor" href="#how-to-run-ithim-global"></a>
</h2>
<p>In this guide we explain how to install the ITHIM-R package, how to
run the model ITHIM-Global using this package and how to produce
summaries of the key results.</p>
<p>Please note that the guide was written for Windows 10 but should work
similarly for different operating systems. We are using the latest R
version - at the time of writing, which is
<code>R version 4.3.3 (2024-02-29)</code>.</p>
<div class="section level3">
<h3 id="how-to-install-the-ithim-r-package">How to install the ITHIM-R package<a class="anchor" aria-label="anchor" href="#how-to-install-the-ithim-r-package"></a>
</h3>
<div class="section level4">
<h4 id="pre-requisites">Pre-requisites<a class="anchor" aria-label="anchor" href="#pre-requisites"></a>
</h4>
<p>The following programmes need to have been installed before the
ITHIM-R package can be used:</p>
<ul>
<li><p><a href="https://github.com/git-guides/install-git" class="external-link">Git</a></p></li>
<li><p><a href="https://cran.r-project.org/" class="external-link">R</a> -
<code>version 4.3.3 (2024-02-29)</code> or above</p></li>
<li><p><a href="https://posit.co/download/rstudio-desktop/" class="external-link">R
Studio</a></p></li>
</ul>
</div>
<div class="section level4">
<h4 id="cloning-the-github-repository">Cloning the Github repository<a class="anchor" aria-label="anchor" href="#cloning-the-github-repository"></a>
</h4>
<p>To clone (i.e. download) the ITHIM-R Github repository, open a
command window by pressing the <code>More</code> button in the
<code>Git</code> tab, and then press <code>New Terminal</code></p>
<p><img src="../reference/figures/new_terminal.png" style="width:100.0%"></p>
<p>and then this terminal window will appear</p>
<p><img src="../reference/figures/terminal.png" style="width:100.0%"></p>
<p>navigate to the folder in which you want to install the repository in
and type:</p>
<pre><code>git clone https://github.com/ITHIM/ITHIM-R.git</code></pre>
<p><img src="../reference/figures/Clone_package.png" style="width:100.0%"></p>
<p><u><strong>Note</strong></u>: If you’d like to install just the
latest version and ignoring the history, you may use
<code>--depth 1</code> parameter, such as:</p>
<pre><code>git clone https://github.com/ITHIM/ITHIM-R.git --depth 1</code></pre>
<p>This will be much quicker to install.</p>
<p>The Github repository has now been downloaded to your computer and
the working branch - the default branch, is set to <code>bogota</code>
which is this documentation refers to.</p>
</div>
<div class="section level4">
<h4 id="installing-the-package-in-rstudio">Installing the package in RStudio<a class="anchor" aria-label="anchor" href="#installing-the-package-in-rstudio"></a>
</h4>
<p>To open the ITHIM-R package in RStudio double click on the
ITHIM-R.Rproj file inside the ITHIM-R folder saved on your computer.
This should open the package in RStudio. Please make sure that you
already have installed the <code>renv</code> package. If it is not
installed, please run this command on your console</p>
<div class="section level5">
<h5 id="install-all-dependent-packages">Install all dependent packages<a class="anchor" aria-label="anchor" href="#install-all-dependent-packages"></a>
</h5>
<p>Before we install the <code>ITHIM</code> package, we need to make
sure that all dependent packages are already installed on your computer.
For that process, please make sure that you already have installed the
<code>renv</code> package. If it is not installed, please run this
command on your console</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"renv"</span><span class="op">)</span></span></code></pre>
<p>This will install the package and you will see this message</p>
<blockquote>
<p>package <code>renv</code> successfully unpacked and MD5 sums
checked</p>
</blockquote>
<p>Once that is completed, you may use the package <code>renv</code> to
verify/check if you already have all the dependent R packages for
<code>ithim</code> locally installed on your computer.</p>
<p>For that, please run the command</p>
<pre><code><span><span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/status.html" class="external-link">status</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p><img src="../reference/figures/renv_status.png" style="width:100.0%"></p>
<p>In case of missing or out of date packages, this will display a list
of them, and then you may run the <code>restore</code> function to have
them all updated/installed, as:</p>
<pre><code><span><span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/restore.html" class="external-link">restore</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p><img src="../reference/figures/renv_restore.png" style="width:100.0%"></p>
<p>This will update and install all the required packages.</p>
</div>
<div class="section level5">
<h5 id="install-the-ithim-r-package">Install the ITHIM-R package<a class="anchor" aria-label="anchor" href="#install-the-ithim-r-package"></a>
</h5>
<p>To install the ITHIM-R package in RStudio, the following steps need
to be performed:</p>
<p>1.) If Git has been installed then there should be a
<code>Build</code> tab in the top right hand corner of RStudio. Click on
this tab and then on <code>Install</code> in the panel below it.</p>
<p><img src="../reference/figures/build_tabwa.png" style="width:100.0%"></p>
<p>Once all missing/out-of-date R packages have been installed using the
<code>renv</code> package, go to the <code>Build</code> tab and install
the ITHIM-R package. It should now install smoothly.</p>
<p>To get the newest updates of the Bogota branch, go to the
<code>Git</code> tab in RStudio next to the <code>Build</code> tab and
click on <code>Pull</code>. This will automatically download the newest
changes from Github. To update the ITHIM-R package on your computer, you
need to again go to the <code>Build</code> tab and click on
<code>Install</code> again. (Alternatively, if only code but none of the
input files have been changed, instead of clicking on
<code>Install</code>, you can also click on <code>More</code> and then
<code>Load All</code> if this option exists for you, i.e. if
<code>devtools</code> has been installed. This is a faster way to update
the package but will only work for minor code changes.) It is
recommended to pull and install the newest updates on a regular
basis.</p>
<p><img src="../reference/figures/Git_pull.png" style="width:100.0%"></p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="running-ithim-global">Running ITHIM-Global<a class="anchor" aria-label="anchor" href="#running-ithim-global"></a>
</h3>
<p>To run ITHIM-Global using the ITHIM-R package the various input files
and parameters need to be updated first. Then the multi_city_script.R
can be used to call the core functions required to run ITHIM-R. Note
that the multi_city_script.R is set up to run ITHIM-Global for various
cities in one go if required by looping through the cities one by
one.</p>
<div class="section level4">
<h4 id="update-input-parameters">Update input parameters<a class="anchor" aria-label="anchor" href="#update-input-parameters"></a>
</h4>
<p>There are several input parameters files that need updating before
running ITIHM-Global:</p>
<ul>
<li><p>5 files specific to each city saved in a directory of the city’s
name. (See <a href="https://github.com/ITHIM/ITHIM-R/tree/bogota/inst/extdata/local/bogota" class="external-link">inst/ext/local/bogota</a>
for example files and also below for further information). These files
need to be saved in the inst/extdata/local/‘city’ folder, where
<code>city</code> is replaced by the appropriate city name.</p></li>
<li><p>file containing the various input parameters for all cities for
which the code is to be run saved in the ITHIM-R folder. In this branch,
this file is called Bogota_InputParameters_vxx.xlsx, where vxx refers to
the latest version number of this file. Here it only contains the input
parameters for Bogota but it can easily be extended to contain the input
parameter values for various cities, using the same format and structure
shown in the sheet.</p></li>
<li><p>global datasets - such as the exposure-response relationships for
the air pollution pathway. These files can be found in the <a href="https://github.com/ITHIM/ITHIM-R/tree/bogota/inst/extdata/global" class="external-link">inst/extdata/global</a>
folder and usually do not need to be changed, unless the user has
different preferences. See below for further information.</p></li>
</ul>
<div class="section level5">
<h5 id="city-specific-files-local-input-parametersdatasets-">City-specific files (local input parameters/datasets).<a class="anchor" aria-label="anchor" href="#city-specific-files-local-input-parametersdatasets-"></a>
</h5>
<p>This section covers the 5 city-specific input files required to run
the model.</p>
<ul>
<li>
<p><strong>Travel survey</strong> <a href="https://raw.githubusercontent.com/ITHIM/ITHIM-R/bogota/inst/extdata/local/bogota/trips_bogota.csv" class="external-link">(example
trips dataset)</a>. A table of all trips taken by a group of people on a
given weekday. It also includes people who take no trips. This data
should come from an official travel survey for the city where
possible.</p>
<ul>
<li>One row per trip (or stage of trip)</li>
<li>Minimal columns: <code>participant_id</code>, <code>age</code>,
<code>sex</code>, <code>trip_mode</code>, <code>trip_duration</code> (or
<code>trip_distance</code>)</li>
<li>Other columns: <code>stage_mode</code>, <code>stage_duration</code>
(or <code>stage_distance</code>)</li>
</ul>
</li>
<li>
<p><strong>Injury events</strong> <a href="https://raw.githubusercontent.com/ITHIM/ITHIM-R/bogota/inst/extdata/local/bogota/injuries_bogota.csv" class="external-link">(example
injuries dataset)</a>. A table of recorded road-traffic injury
(fatality) events in a city during one or more years.NOV refers to No
Other Vehicle.</p>
<ul>
<li>One row per event</li>
<li>Minimal columns: <strong>victim mode</strong>
(<code>cas_mode</code>) and <strong>strike mode</strong>
(<code>strike_mode</code>)</li>
<li>Other columns: <code>year</code>, <code>cas_age</code>,
<code>cas_gender</code>, <code>weight</code> (weight column should give
number of years for which data exists if no <code>year</code>
information is given)</li>
</ul>
</li>
<li>
<p><strong>Baseline mortality and years of life lost</strong> <a href="https://raw.githubusercontent.com/ITHIM/ITHIM-R/bogota/inst/extdata/local/bogota/gbd_bogota.csv" class="external-link">(example
dataset)</a>. This gives the burden of mortality and years of life lost
(YLL) for different causes of mortality and YLL. If no city-specific
information exists, country level information can be used.</p>
<ul>
<li>One row per health outcome/metric/age/gender combination</li>
<li>Minimal rows: <code>Measure</code> (death/YLL);
<code>sex_name</code> (Male/Female); <code>age_name</code> (‘x to y’);
<code>cause_name</code> (health outcome names); <code>val</code> (value
of burden); <code>population</code> (number of people <code>val</code>
corresponds to, e.g. population of country)</li>
</ul>
</li>
<li>
<p><strong>Population of city</strong> <a href="https://raw.githubusercontent.com/ITHIM/ITHIM-R/bogota/inst/extdata/local/bogota/population_bogota.csv" class="external-link">(example
population dataset)</a>. This information is used to scale the baseline
mortality and YLL data from the country’s value to the city’s population
under study.</p>
<ul>
<li>One row per demographic group</li>
<li>Columns: <code>sex</code>, <code>age</code>,
<code>population</code>
</li>
<li>
<code>age</code> column should share boundaries with
<code>age_name</code> in the baseline mortality and YLL data, but can be
more aggregated.</li>
</ul>
</li>
<li>
<p><strong>Physical activity survey</strong> <a href="https://raw.githubusercontent.com/ITHIM/ITHIM-R/bogota/inst/extdata/local/bogota/pa_bogota.csv" class="external-link">(example
physical activity dataset)</a>. This is used to represent the physical
activity levels in the city and should be taken from an official
physical activity survey of the city where possible.</p>
<ul>
<li>One row per person</li>
<li>Columns: <code>sex</code>, <code>age</code>,
<code>ltpa_marg_met</code> (background non-transport, non-occupational
weekly PA volume in mMETS hours)</li>
</ul>
</li>
</ul>
</div>
<div class="section level5">
<h5 id="global-files-global-input-parametersdatasets">Global files (global input parameters/datasets)<a class="anchor" aria-label="anchor" href="#global-files-global-input-parametersdatasets"></a>
</h5>
<p>In order to setup the model, we need a fixed list of tables/datasets,
which do not change across cities/ applied similarly to all cities and
are hence referred to as “Global”, such as:</p>
<ul>
<li><p><a href="https://raw.githubusercontent.com/ITHIM/ITHIM-R/bogota/inst/extdata/global/dose_response/disease_outcomes_lookup.csv" class="external-link"><strong>Health
outcome interaction table</strong></a>. A table with a list of health
outcomes related to a specific pathway such as
<code>Air Pollution</code> and <code>Physical Activity</code> and also
the interaction between them.</p></li>
<li><p><a href="https://github.com/ITHIM/ITHIM-R/tree/bogota/inst/extdata/global/dose_response/drap/extdata" class="external-link"><strong>Air
Pollution Exposure Response Functions
(ERFs)</strong></a><strong>.</strong> These give the exposure-response
relationships between air pollution (PM2.5) and its impact on health for
different health outcomes. We have collected/cleaned datasets from
published studies for this.</p></li>
<li><p><a href="https://meta-analyses.github.io/drpa/drpa.html" class="external-link"><strong>Physical
Activity Dose-Response Functions (DRFs)</strong></a>. These are
dose-response relationships of physical activity and its impact on
health for different health outcomes. Similar to air pollution, this too
comes from published studies. This now sits in an independent R package
called <a href="https://github.com/meta-analyses/drpa/" class="external-link"><code>drpa</code></a>.</p></li>
<li><p><strong>Ventilation rate tables</strong>. This data can be found
in <a href="https://github.com/ITHIM/ITHIM-R/tree/bogota/inst/extdata/global/ventilation_rate" class="external-link">inst/extdata/global/ventilation_rate</a>
and details the distribution and parameters required to estimate how
much air is being inhaled by different people across different
activities in the model’s baseline population.</p></li>
</ul>
</div>
</div>
<div class="section level4">
<h4 id="call-multi_city_script-r">Call multi_city_script.R<a class="anchor" aria-label="anchor" href="#call-multi_city_script-r"></a>
</h4>
<p>In order to run ITHIM-R once it has been installed and the various
input files described above have been updated, open the
<code>multi_city_script.R</code> file within RStudio. This file can be
found under the <code>Files</code> tab in the middle pane on the right
hand side. This is the key script to run ITIHM-Global in constant mode
(i.e. keeping the input parameters fixed, without sampling the input
parameters from distributions). It reads in all the required datasets
and initialises all variables by calling <code>run_ithim_setup</code>
and then runs the model by calling <code>run_ithim</code>.</p>
<p>First, update the parameter values at the beginning of the script to
set-up e.g. for which city / cities the script is to be run. This can be
found in Line 63 and has been set to ‘bogota’ in this worked
example.</p>
<p><img src="../reference/figures/multi_city_script_specifcy_cities_gh.png" style="width:100.0%"></p>
<p><a href="https://github.com/ITHIM/ITHIM-R/blob/de2a88548af6c6be5eb36d939e178b146d1ba055/multi_city_script.R#L63" class="external-link uri">https://github.com/ITHIM/ITHIM-R/blob/de2a88548af6c6be5eb36d939e178b146d1ba055/multi_city_script.R#L63</a></p>
<p>If several city names are given as a vector, the model performs the
ITHIM-R analysis for one city after another.</p>
<p>Once these parameter values have been updated, click on
<code>Source</code> and the model should run.</p>
<p><img src="../reference/figures/multi_city_scriptwa.png" style="width:100.0%"></p>
<p>It produces pop-up windows showing the plots of the results giving
the years of life lost for each scenario and required health
outcomes.</p>
</div>
<div class="section level4">
<h4 id="ithim_objects">ithim_objects<a class="anchor" aria-label="anchor" href="#ithim_objects"></a>
</h4>
<p>The ithim_objects list is saved under
<em>results/multi_city/io_“,output_version,”.rds</em>, where the
output_version is currently set as the SHA number (i.e. the unique
identifier) of the latest update on Github but can also be updated
manually by the user in the <code>multi_city_script.R</code>.</p>
<p>You may view it using the command <code>View(ithim_objects)</code>
and it will then show you its content as such:</p>
<p><img src="../reference/figures/view_ithim_objectswa.png" style="width:100.0%"></p>
<p>You may click on individual sub-items such as <code>bogota</code> for
more information.</p>
<p><img src="../reference/figures/ithim_objects_bogotawa.png" style="width:100.0%"></p>
<p>This list contains a comprehensive set of intermediate and final
results from the model run:</p>
<p>For each city modelled it contains the following data:</p>
<ul>
<li><p><strong>trip_scen_sets</strong>: trip data for all scenarios for
the baseline population, i.e. the population sample built by combining
the household travel survey and physical activity survey data.</p></li>
<li><p><strong>dist</strong>: total stage mode distances for each mode
and scenario (including baseline) for the baseline population.</p></li>
<li><p><strong>dur</strong>: total stage mode durations for each mode
and scenario (including baseline) for the baseline population.</p></li>
<li><p><strong>true_dist</strong>: distances from the trip data scaled
up to the total distance travelled by the baseline population of the
city (for age ranges considered in the model only) for each scenario
(including baseline) and mode of transport.</p></li>
<li>
<p><strong>inj_distances</strong>:</p>
<ul>
<li><p><strong>true_distances</strong>: city baseline population mode
distances by age category and sex considered in the model.</p></li>
<li><p><strong>injuries_list</strong>: For all scenarios (including
baseline) two lists are given, one for <code>whw</code> (who-hit-whom)
injuries where both the strike and the casualty mode are known and one
for <code>nov</code> (no other vehicle) injuries where no strike vehicle
was involved in the crash These lists contain all casualty (and strike)
mode combinations by age category and sex. Furthermore, they detail
casualty (and strike) mode distances travelled by the entire city
baseline population considered in the model (‘_sum’) or just by the
respective age and sex category. They also detail the casualty (and
strike) mode exponents used in the injury Poisson regression
model.</p></li>
<li><p><strong>reg_model</strong>: parameterised Poisson injury
regression model for injuries.</p></li>
<li><p><strong>injuries_for_model</strong>: baseline data containing
fatality counts for all casualty and strike mode combinations with
associated city’s baseline population distance data
(<code>true_distances</code> explained above) .</p></li>
</ul>
</li>
<li><p><strong>demographic</strong>: city population counts for all age
categories and sex combinations considered in the model.</p></li>
<li><p><strong>synth_pop</strong>: population extracted from the
physical activity survey assigning non-transport, non-occupational PA
component of physical activity values in mMETs hours per person per
week.</p></li>
<li>
<p><strong>outcomes</strong>:</p>
<ul>
<li><p><strong>mmets</strong>: Marginal MET values for each person in
the baseline population for each scenario.</p></li>
<li><p><strong>pm_conc_pp</strong>: PM2.5 concentration attributed to
each person in the baseline population for each scenario (including
baseline).</p></li>
<li><p><strong>co2_emission_inventory</strong>: total CO2 emission
levels for each mode of transport and scenario (including
baseline).</p></li>
<li><p><strong>ref_injuries</strong>: number of injury deaths and years
of life lost by age and sex category for the baseline scenario including
upper and lower confidence interval values</p></li>
<li><p><strong>hb</strong>: health burden (deaths and years of life lost
(YLL) in two separate dataframes) for each age and sex category and each
health outcome using the combined result for health outcomes impacted by
both air pollution and physical activity levels.</p></li>
<li><p><strong>pathway_hb</strong>: health burden (deaths and years of
life lost (YLL) in two separate dataframes) for each age and sex
category and each health outcome keeping the results for health outcomes
impacted by both air pollution and physical activity levels
separate.</p></li>
<li><p><strong>whw</strong>: number of fatalities by strike and casualty
modes for who-hit-whom and no-other-vehicle injuries for all scenarios
(including baseline).</p></li>
</ul>
</li>
<li><p><strong>disease_burden</strong>: health outcome burden for all
health outcomes for the baseline scenario (deaths and years of life
lost) for all age and sex categories considered in the model (from input
data).</p></li>
<li><p><strong>PM_emission_inventory</strong>: PM emission inventory by
mode of transport for the baseline scenario (from input data).</p></li>
<li><p><strong>injury_table</strong>: summarised total road fatality
counts from the injury input data by age and sex category and strike and
casualty mode for all years (<code>weight</code> column) given in the
input data for both <code>whw</code> (who-hit-whom) and <code>nov</code>
(no-other-vehicle) injuries.</p></li>
<li><p><strong>vehicle_inventory</strong>: gives the speed and CO2 and
PM2.5 emissions inventories for all vehicles in the baseline
scenario.</p></li>
<li><p><strong>location</strong>: country and continent
information.</p></li>
<li><p><strong>new_walk_trips_count</strong>: number of rail and bus
trips to which an additional walking stage was added during the model
run.</p></li>
</ul>
<p><strong>Scen_prop</strong>:</p>
<ul>
<li>the proportion of trips by mode to be converted for each distance
category and scenario.</li>
</ul>
<p><strong>Ithim_run</strong>:</p>
<ul>
<li>information about the ITHIM-R run such as the name of the input
parameters file, the name of the scenario definition used, the baseline
scenario, the scenario names, the computation mode (constant or sample),
the timestamp of the model run, the output version number, the author of
the model run and any additional comments about this particular model
run.</li>
</ul>
</div>
<div class="section level4">
<h4 id="summary-of-key-results">Summary of key results<a class="anchor" aria-label="anchor" href="#summary-of-key-results"></a>
</h4>
<p>There are various scripts which can be used to produce output summary
tables of the results:</p>
<ul>
<li>
<p>three markdown documents (in root folder, as shown below)
producing html and csv files:</p>
<ul>
<li>summary_tables.Rmd</li>
<li>summary_tables_PA_AP.Rmd</li>
<li>injury_tables.Rmd</li>
</ul>
</li>
</ul>
<p>Note: please execute the command below</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"Create_output_summaries.R"</span><span class="op">)</span></span></code></pre>
<p>to run (or <code>knit</code>) all three documents above - this will
produce html files and along with the necessary CSV files (stored in the
<code>results</code> subfolder)</p>
<ul>
<li>
<p>Shiny application creating a Pivot table:</p>
<ul>
<li>app.R in results_app folder</li>
</ul>
</li>
</ul>
<div class="section level5">
<h5 id="producing-the--rmd-file-outputs">Producing the .Rmd file outputs<a class="anchor" aria-label="anchor" href="#producing-the--rmd-file-outputs"></a>
</h5>
<p>To run the various .Rmd files, you can use the
<code>Create_output_summaries.R</code> script saved in the root folder
by <code>source("Create_output_summaries.R")</code></p>
<p>The following outputs are produced:</p>
</div>
<div class="section level5">
<h5 id="summary_tables-rmd">summary_tables.Rmd<a class="anchor" aria-label="anchor" href="#summary_tables-rmd"></a>
</h5>
<p>The .Rmd file summarises mode splits, distances and durations
travelled, in addition to the attributable health impacts (YLL and
deaths from different health outcomes) for the different injury,
physical activity (PA) and air pollution (AP) pathways but also by
health outcome</p>
<p>It produces the following output documents:</p>
<ul>
<li>html file (saved in the root folder) containing the information
listed below.</li>
</ul>
<p>Note that the Rmd file was set up to produce many more distance,
duration and health outcomes tables which have all been commented out to
highlight the main results but could easily be added in again:</p>
<ul>
<li><p>a table displays the Baseline mode split for each distance
category, in this case: 0-2 km, 2-6 km and &gt;6km</p></li>
<li><p>a table displays the mode split for each scenario</p></li>
<li><p>city-specific distance tables showing average daily distances in
km travelled by each person in the baseline population by mode for all
scenarios (including Baseline)</p></li>
<li><p>city-specific distance tables showing average daily distances in
km travelled by each person in the baseline population WITH a trip by
mode for all scenarios (including Baseline)</p></li>
<li><p>city-specific duration tables showing average daily duration
(mins) spent travelling by each person in the baseline population by
mode for all scenarios (including Baseline)</p></li>
<li><p>city-specific duration tables showing average daily duration
(mins) spent travelling by each person in the baseline population WITH a
trip by mode for all scenarios (including Baseline)</p></li>
<li>
<p>output .csv files containing the information listed below. Note
that all these files are also saved with their version number in the
file name:</p>
<ul>
<li><p>the ylls.csv file (results/multi_city/health_impacts/ylls.csv)
gives the changes in YLL for each age and sex category, health outcome
and scenario as compared to the baseline scenario. It also shows the
health outcomes in the three level heirarchy, and whether the health
outcome is attributed to changes in AP, PA or both, and the age, and age
and sex specific population levels. The results are for either AP and PA
only if the health outcomes are only impacted by AP or PA seperately, or
the results are combined for AP and PA, if the health outcomes are
impacted by both AP and PA.</p></li>
<li><p>the ylls_pathway.csv file
(results/multi_city/health_impacts/ylls_pathway.csv) gives the changes
in YLL for each age and sex category, health outcome and scenario as
compared to the baseline scenario. It also shows the health outcome in
the three level hierarchy, and whether the health outcome is attributed
to changes in AP or PA, and the age, and age and sex specific population
levels. The results are given for AP and PA independently even if a
health outcome is impacted by both pathways.</p></li>
<li><p>the deaths.csv file
(results/multi_city/health_impacts/deaths.csv) gives the changes in
deaths for each age and sex category, health outcome and scenario as
compared to the baseline scenario. It also shows the the health outcomes
in the three level hierarchy, whether the health outcome is attributed
to changes in AP, PA or both, and the age, and age and sex specific
population levels. The results are for either AP and PA only if the
health outcomes are impacted by only AP or PA or the results are
combined for AP and PA impacts if the health outcomes are impacted by
both AP and PA.</p></li>
<li><p>the deaths_pathway.csv file
(results/multi_city/health_impacts/deaths_pathway.csv) gives the changes
in deaths for each age and sex category, health outcome and scenario as
compared to the baseline scenario. It also shows the health outcome in
the three level hierarchy, and whether the health outcome is attributed
to changes in AP or PA, and the age, and age and sex specific population
levels. The results are given for AP and PA independently even if a
health outcome is impacted by both pathways.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section level5">
<h5 id="summary_tables_pa_ap-rmd">summary_tables_PA_AP.Rmd<a class="anchor" aria-label="anchor" href="#summary_tables_pa_ap-rmd"></a>
</h5>
<p>This .Rmd file can be used to summarise the ambient PM2.5
concentrations, the PM2.5 personal exposure levels, CO2 emissions and
physical activity levels for all scenarios including the baseline.</p>
<p>It produces the following output documents:</p>
<ul>
<li>
<p>html file (saved in the root folder) containing the information
listed below:</p>
<ul>
<li><p>boxplots of daily individual PM2.5 exposure levels for each
scenario including baseline</p></li>
<li><p>one table detailing the individual PM2.5 exposure levels
including the mean, 5th, 50th and 95th percentiles, the mean PM2.5
concentration levels for each scenario and the change in PM2.5 as
compared to the baseline scenario</p></li>
<li><p>one table detailing the percentage of baseline PM2.5 emissions
attributed to each transport mode, the city wide PM2.5 concentration and
the percentage of concentration attributed to transport</p></li>
<li><p>one table detailing the baseline CO2 emissions for each
scenario</p></li>
<li><p>boxplots of individual mMET physical activity levels for each
scenario</p></li>
<li><p>one table giving the mean, 5th, 50th and 95th percentile levels
of individual physical activity levels (mMETs) for each
scenario</p></li>
<li><p>one table detailing the average mMETs levels for each
scenario</p></li>
<li>
<p>2nd Option:</p>
<ul>
<li><p>boxplots of daily individual PM2.5 exposure levels for each
scenario</p></li>
<li><p>one table detailing the baseline PM2.5 emissions for each mode,
the city wide PM2.5 concentration and the percentage of concentration
attributed to transport</p></li>
<li><p>one table detailing the individual PM2.5 exposure levels
including the mean, 5th, 50th and 95th percentiles, the mean PM2.5
concentration for each scenario and the change in PM2.5 as compared to
the baseline scenario. The table also contains CO2 emissions for each
scenario</p></li>
<li><p>boxplots of individual mMET physical activity levels for each
scenario</p></li>
</ul>
</li>
</ul>
</li>
<li>
<p>output .csv/.xlsx files containing the information listed
below:</p>
<ul>
<li><p>desc_stats.csv file (results/multi_city/AP/desc_stats.csv, also
saved with output version in name) containing the summary statistics of
individual PM2.5 exposure levels, the total PM2.5 concentration, the
change in PM2.5 concentration as compared to the baseline scenario and
the total transport related CO2 emissions for each scenario</p></li>
<li>
<p>desc_stats.xlsx file
(results/multi_city/AP/desc_stats_<em>output_version</em>.xlsx)
containing the following tabs:</p>
<ul>
<li><p>PM_2.5_emission_inventory: table detailing the percentage
Baseline PM2.5 emissions attributed to each transport mode, the city
wide PM2.5 concentration and the percentage of concentrations attributed
to transport</p></li>
<li><p>CO2_emission_inventory: table detailing the CO2 emissions for
each scenario</p></li>
<li><p>summary_stats_PM2.5_CO2: summary statistics of individual PM2.5
exposure levels, the total PM2.5 concentration, the change in PM2.5
concentration as compared to the baseline scenario and the total
transport related CO2 emissions for each scenario</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level5">
<h5 id="injury_tables-rmd">injury_tables.Rmd<a class="anchor" aria-label="anchor" href="#injury_tables-rmd"></a>
</h5>
<p>This .Rmd file can be used to summarise the injury outcomes. It
produces the following output documents:</p>
<ul>
<li>
<p>html file (saved in the root folder) containing the information
listed below:</p>
<ul>
<li><p>fatality counts by strike and casualty mode for each scenario
(including lower and upper confidence interval values were applicable);
one table for each scenario and mean, upper or lower confidence interval
values</p></li>
<li><p>fatality counts giving lower, mean and upper bounds (where
applicable) for each casualty mode by strike mode for each scenario; one
table for each casualty mode, scenario</p></li>
<li><p>tables showing the fatalities per billion km travelled for each
scenario and mean, upper and lower confidence interval values (where
applicable).</p></li>
<li><p>tables showing the number of deaths per 100,000 people for each
scenario and mean, upper and lower confidence interval values (where
applicable).</p></li>
<li><p>tables showing the fatalities per 100 million hours travelled for
each scenario and mean, upper and lower confidence interval values
(where applicable).</p></li>
</ul>
</li>
<li>
<p>output .csv files containing the information listed below. Note
that all these files are also saved with their version number in the
file name:</p>
<ul>
<li><p>The inj_counts.csv file
(<code>results/multi_city/inj/inj_counts.csv</code>) contains the
fatality counts (mean and upper and lower confidence interval values if
required, each in their seperate row) for each scenario and casualty and
strike mode pair. It also includes the observed baseline fatality counts
and the active travel fatality counts under the casualty mode (the sum
of cycle and walk casualty mode fatalities)</p></li>
<li><p>The injury_risks_per_billion_kms.csv file
(<code>results/multi_city/inj/injury_risks_per_billion_kms.csv</code>)
gives the fatalities per billion km travelled for each scenario and
casualty mode. It also includes the upper and lower confidence interval
values if required, each in their separate row, and active travel counts
which sum walking and cycling</p></li>
<li><p>The injury_risks_per_100k_pop.csv file
(<code>results/multi_city/inj/injury_risks_per_100k_pop.csv</code>)
gives the fatalities per 100k people for each scenario and casualty
mode. It also includes the upper and lower confidence interval values if
required, each in their separate row, and active travel counts which sum
walking and cycling</p></li>
<li><p>The distances.csv file
(<code>results/multi_city/inj/distances.csv</code>) contains the
population distances travelled per day for each scenario and
mode</p></li>
<li><p>The injury_risks_per_100million_h.csv file
(<code>results/multi_city/inj/injury_risks_per_100million_h.csv</code>)
gives the fatalities per 100 million hours travelled for each scenario
and casualty mode. It also includes the upper and lower confidence
interval values if required, each in their seperate row, and active
travel counts which sum walking and cycling</p></li>
</ul>
</li>
<li><p>The inj_data.xlsx file (results/multi_city/inj/inj_data.xlsx)
contains all injury output csv files</p></li>
</ul>
</div>
<div class="section level5">
<h5 id="shiny-app-pivot-table">Shiny App Pivot table<a class="anchor" aria-label="anchor" href="#shiny-app-pivot-table"></a>
</h5>
<p>This application allows you to produce Pivot tables for both health
and injury outcomes. The Pivot tables allow you to filter the outcomes
as follows.</p>
<ul>
<li>for the health outcomes (which include road traffic injuries (RTI)):
<ul>
<li>by scenario</li>
<li>by deaths or years of life lost</li>
<li>by health outcome levels in the three levels hierarchy</li>
<li>by age and sex group</li>
<li>by pathway / dose</li>
<li>whether to include the interaction between the air pollution and
physical activity pathways or not</li>
<li>whether to include confidence intervals or not</li>
</ul>
</li>
<li>for the injury risks:
<ul>
<li>by scenario</li>
<li>by mode</li>
<li>by risk type (total fatalities, per billion km, per 100k people, per
100 million hours)</li>
</ul>
</li>
</ul>
</div>
<div class="section level5">
<h5 id="producing-the-shiny-app-pivot-table-output">Producing the Shiny App Pivot table output<a class="anchor" aria-label="anchor" href="#producing-the-shiny-app-pivot-table-output"></a>
</h5>
<p>To produce these Shiny App Pivot tables, run the function
<code>app.R</code> in the <code>results_app</code> folder. Depending on
whether you want to read in the results from the latest updates on
Github or from your local drive, set</p>
<pre><code><span><span class="va">github_path</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/ITHIM/ITHIM-R/bogota/"</span></span></code></pre>
<p>or</p>
<pre><code><span><span class="va">github_path</span> <span class="op">&lt;-</span> <span class="st">"../"</span></span></code></pre>
<p>(Comment out the option you don’t need.)</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="structure-of-ithim-global-github-repository---bogota-branch">Structure of ITHIM-Global Github repository - Bogota branch<a class="anchor" aria-label="anchor" href="#structure-of-ithim-global-github-repository---bogota-branch"></a>
</h3>
<p>The Github repository of the Bogota branch is structured as
follows:</p>
<ul>
<li><p><strong>.github</strong>: specifies the metadata for the various
documents, automatically created by Github.</p></li>
<li><p><strong>R</strong>: contains all the R functions written for the
ITIHM-R package.</p></li>
<li><p><strong>inst/extdata</strong>: folder containing the local
city-specific and the global input files.</p></li>
<li><p><strong>man</strong>: manual containing the various functions
used within ITHIM-R and the figures used in the various documentation
documents. It is also built automatically.</p></li>
<li><p><strong>results</strong>: contains the results from the model
runs.</p></li>
<li><p><strong>results_app</strong>: contains the functions used to
produce Shiny pivot tables of the results.</p></li>
<li><p><strong>vignettes</strong>: contains additional documentation
information</p></li>
<li><p>.Rbuildignore, .gitignore: metadata created by Github.</p></li>
<li><p>Bogota_InputParameters_vxx.xlsx - file containing the local
city-specific input parameters which needs manual updating.</p></li>
<li><p>Create_output_summaries.R - wrapper script to create the various
output documents.</p></li>
<li><p>DESCRIPTION: automatically created by Github.</p></li>
<li><p>How_To_Run_ITHIM: document describing the various steps needed to
run the ITHIM-Global model from downloading and installing ITHIM-R to
preparing the input parameters files and running the code.</p></li>
<li><p>ITHIM-R.Rproj: contains the metadata for the ITHIM-R
package.</p></li>
<li><p>LICENSE: gives information about the licence that has been
applied to this repository.</p></li>
<li><p>NAMESPACE: automatically created by Github.</p></li>
<li><p>OutputVersionControl.txt: file storing the main run information
of the ITHIM-R runs. This is automatically updated, if required, when
using the multi_city_script.R.</p></li>
<li><p>README: document giving an overview of the ITHIM-R
package.</p></li>
<li><p>_config.yml, _pkgdown.yml: metadata created by Github.</p></li>
<li><p>injury_tables.Rmd: R markdown document that can be used to create
summary statistics of the injury results.</p></li>
<li><p>injury_tables_<em>output_version</em>.html: html files containing
injury summary statistics of the respective model runs.</p></li>
<li><p>multi_city_script.R: wrapper function to call all the various
functions needed to perform the ITHIM-Global analysis.</p></li>
<li><p>summary_tables.Rmd: R markdown document to create summary output
statistics about distance, duration, mode splits and health
outcomes.</p></li>
<li><p>summary_tables_<em>output_version</em>.html: html files
containing output summaries of the respective model runs.</p></li>
<li><p>summary_tables_PA.Rmd: R markdown document to create summary
output statistics about air pollution and physical activity
levels.</p></li>
<li><p>summary_tables_PA_<em>output_version</em>.html: html files
containing air pollution and physical activity output statistics of the
respective model runs.</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ali Abbas, Anna Schroeder, Daniel Gil, Lambed Tatah, Rob Johnson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
